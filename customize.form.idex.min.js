/*!
* IDeX Custom form element v0.1.0
* http://idesignexperiences.com/#custom-form-element
*
* Includes parts of jQuery
* (http://jquery.com/), released under the MIT Licence (https://github.com/jquery/jquery/blob/master/MIT-LICENSE.txt)
*
* Copyright 2013, 2014 SÃ©bastien Filion me@idesignexperiences.com
* Released under the MIT license
*
* Built on: 2014/02/18
*
*/

!function(a,b,c){function d(b,c){var d;return d={callbacks:{},template:"",classes:{active:"active",focus:"focus",hide:"hide"},attributes:["name","id","class","value"]},this.element=b,this.configs=d,this.configs=a.merge(this.configs,c),this}a.merge=function(b,c){if(!b)return c;if(!c)return b;if("object"!=typeof c||"object"==typeof c&&c instanceof Array&&c instanceof Function)return c;for(key in c)b[key]=b.hasOwnProperty(key)?a.merge(b[key],c[key]):c[key];return b},a.hasOwnProperty("render")||(a.render=function(a,c){return b.Mustache.render(a,c)}),a.hasOwnProperty("addClass")||(a.addClass=function(b,c){function d(b){a.hasClass(b,c)||(b.className=b.className+" "+c)}if(b.hasOwnProperty("length"))for(var e=0;e<b.length;e++)d(b[e]);else d(b)}),a.hasOwnProperty("removeClass")||(a.removeClass=function(a,b){function c(a){a.className=a.className.replace(new RegExp("(^|\\s+)"+b+"(\\s+|$)","g"),"$1")}if(a.length)for(var d=0;d<a.length;d++)c(a[d]);else c(a)}),a.hasOwnProperty("hasClass")||(a.hasClass=function(a,b){var c=" "+b+" ",d=/[\t\r\n\f]/g;return 1===a.nodeType&&(" "+a.className+" ").replace(d," ").indexOf(c)>=0?!0:!1}),a.hasOwnProperty("on")||(a.on=function(a,c,d){a.addEventListener?a.addEventListener(c,d,!1):a.attachEvent("on"+c,function(){return d.call(a,b.event)})}),a.hasOwnProperty("fire")||(a.fire=function(a,b){if(c.createEvent){var d=c.createEvent("HTMLEvents");return d.initEvent(b,!0,!0),!a.dispatchEvent(d)}var d=c.createEventObject();return a.fireEvent("on"+b,d)}),a.hasOwnProperty("preventDefault")||(a.preventDefault=function(a){a.preventDefault?a.preventDefault():a.returnValue=!1});var e,f;e={box:"<div></div>",button:'<a href="" title="{{ value }}">{{ value }}</a>',select:'<div class="select"><div class="select-selected" data-element="selected">{{ selected }}</div><div class="select-dropdown" data-element="dropdown"><ul>{{ #options }}<li data-value="{{ value }}" data-element="option"">{{ text }}</li>{{ /options }}</ul></div></div>'},d.prototype={initialize:function(){var b,d,e;for(var f in arguments){var g=arguments[f];g instanceof Function?e=g:g instanceof Object&&(d=g)}d||(d={}),b=c.createElement("div"),b.innerHTML=a.render(this.configs.template,d);for(var h in this.configs.attributes){var i=this.configs.attributes[h];"class"===i&&""!==this.element.className?b.childNodes[0].className=this.element.className:this.element.hasAttribute(i)&&b.childNodes[0].setAttribute("data-"+i,this.element[i])}return this.customElement=b.childNodes[0],this.element.parentNode.insertBefore(this.customElement,this.element.nextSibling),this.element.style.position="absolute",this.element.style.left="-9999px",e&&e.apply(this),this}},f=b.makers||{},f.box=function(b){b.hasOwnProperty("template")||(b.template=e.box);var f,g;f=this,g=new d(f,b),g.initialize(function(){a.addClass(this.customElement,this.element.type),a.on(this.element,"change",function(){if(g.configs.callbacks.hasOwnProperty("beforechange")&&g.configs.callbacks.beforechange.apply(g.element),"radio"===f.type){var b=c.querySelectorAll('[data-name="'+f.name+'"]');if(b.length)for(var d=0;d<b.length;d++)a.removeClass(b[d],g.configs.classes.active)}g.element.checked?a.addClass(g.customElement,g.configs.classes.active):a.removeClass(g.customElement,g.configs.classes.active),g.configs.callbacks.hasOwnProperty("afterchange")&&g.configs.callbacks.afterchange.apply(g.element)}),a.on(this.element,"focus",function(){a.addClass(g.customElement,g.configs.classes.focus)}),a.on(this.element,"blur",function(){a.removeClass(g.customElement,g.configs.classes.focus)}),a.on(this.customElement,"click",function(){g.element.checked=a.hasClass(g.customElement,g.configs.classes.active)?!1:!0,a.fire(g.element,"change")})})},f.submit=function(b){b.hasOwnProperty("template")||(b.template=e.button);var c,f;c=this,f=new d(c,b),value=this.value,f.initialize({value:value},function(){a.on(this.customElement,"click",function(b){a.preventDefault(b),a.fire(f.element,"click")})})},f.select=function(c){c.hasOwnProperty("template")||(c.template=e.select);var f,g;f=this,g=new d(f,c);var h,i;h=[];for(var j=0;j<f.length;j++){var k;k=f[j].textContent||f[j].text,value=f[j].value,f[j].selected&&(i=f[j].text||f[j].textContent),h.push({text:k,value:value})}g.initialize({selected:i,options:h},function(){function c(){a.removeClass(i,g.configs.classes.hide)}function d(){b.setTimeout(function(){a.addClass(i,g.configs.classes.hide)},200)}function e(a){for(var b=0;b<g.element.length;b++)if(g.element[b].value===a)return b}function f(b){var c;c=b.currentTarget.getAttribute("data-value"),g.element.selectedIndex=e(c),a.fire(g.element,"change")}var h,i,j;h=this.customElement.querySelector('[data-element="selected"]'),i=this.customElement.querySelector('[data-element="dropdown"]'),j=this.customElement.querySelectorAll('[data-element="option"]'),a.on(this.element,"change",function(){g.configs.callbacks.hasOwnProperty("beforechange")&&g.configs.callbacks.beforechange.apply(g.element);var b,c;b=g.element.selectedIndex,c=j[g.element.selectedIndex],a.removeClass(j,g.configs.classes.active),a.addClass(c,g.configs.classes.active),h.innerText=g.element[b].text||g.element[b].textContent,g.configs.callbacks.hasOwnProperty("afterchange")&&g.configs.callbacks.afterchange.apply(g.element)}),a.on(this.element,"focus",function(){a.addClass(g.customElement,g.configs.classes.focus),c()}),a.on(this.element,"blur",function(){a.removeClass(g.customElement,g.configs.classes.focus),d()}),h&&a.on(h,"click",function(){g.element.focus()});for(var k=0;k<j.length;k++)a.on(j[k],"click",f);d()})},a.customize=function(b,c){function d(b,d){if("FORM"===b.tagName&&a.customize(b,c),"INPUT"===b.tagName){if("radio"!==b.type&&"checkbox"!==b.type&&"submit"!==b.type&&"button"!==b.type)return!1;"radio"===b.type||"checkbox"===b.type?f.box.call(b,[d]):("submit"===b.type||"button"===b.type)&&f.submit.call(b,[d])}else"SELECT"===b.tagName&&f.select.call(b,[d])}if(!b)throw new Error("No element was submitted...");if(b.length)for(var e=0;e<b.length;e++){var g,h,i;g={},c&&c.hasOwnProperty(b[e].name)&&(h=c[b[e].name],g=a.merge(g,h)),c&&c.hasOwnProperty(b[e].type)&&(i=c[b[e].type],g=a.merge(g,i)),d(b[e],g)}else d(b,c);return b}}(window.idex=window.idex||{},window,document);