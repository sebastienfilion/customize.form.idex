/*!
* IDeX Custom form element v0.1
* http://idesignexperiences.com/#custom-form-element
*
* Includes parts of jQuery
* (http://jquery.com/), released under the MIT Licence (https://github.com/jquery/jquery/blob/master/MIT-LICENSE.txt)
*
* Copyright 2013, 2014 SÃ©bastien Filion me@idesignexperiences.com
* Released under the MIT license
*
* Built on: 2014/02/02
*
*/

!function(a,b,c){function d(b,c){var d;return d={callbacks:{},template:"",classes:{active:"active",focus:"focus",hide:"hide"},attributes:["name","id","class","value"]},this.element=b,this.configs=d,this.configs=a.merge(this.configs,c),this}a.merge=function(b,c){if(!b)return c;if(!c)return b;if("object"!=typeof c||"object"==typeof c&&c instanceof Array&&c instanceof Function)return c;for(key in c)b[key]=b.hasOwnProperty(key)?a.merge(b[key],c[key]):c[key];return b},a.hasOwnProperty("render")||(a.render=function(a,c){return b.Mustache.render(a,c)}),a.hasOwnProperty("addClass")||(a.addClass=function(b,c){function d(b){a.hasClass(b,c)||(b.className=b.className+" "+c)}if(b.hasOwnProperty("length"))for(var e=0;e<b.length;e++)d(b[e]);else d(b)}),a.hasOwnProperty("removeClass")||(a.removeClass=function(a,b){function c(a){a.className=a.className.replace(new RegExp("(^|\\s+)"+b+"(\\s+|$)","g"),"$1")}if(a.length)for(var d=0;d<a.length;d++)c(a[d]);else c(a)}),a.hasOwnProperty("hasClass")||(a.hasClass=function(a,b){var c=" "+b+" ",d=/[\t\r\n\f]/g;return 1===a.nodeType&&(" "+a.className+" ").replace(d," ").indexOf(c)>=0?!0:!1}),a.hasOwnProperty("on")||(a.on=function(a,c,d){a.addEventListener?a.addEventListener(c,d,!1):a.attachEvent("on"+c,function(){return d.call(a,b.event)})}),a.hasOwnProperty("fire")||(a.fire=function(a,b){if(c.createEvent){var d=c.createEvent("HTMLEvents");return d.initEvent(b,!0,!0),!a.dispatchEvent(d)}var d=c.createEventObject();return a.fireEvent("on"+b,d)}),a.hasOwnProperty("preventDefault")||(a.preventDefault=function(a){a.preventDefault?a.preventDefault():a.returnValue=!1});var e;e={box:"<div></div>",button:'<a href="" title="{{ value }}">{{ value }}</a>',select:'<div class="select"><div class="select-selected" data-element="selected">{{ selected }}</div><div class="select-dropdown" data-element="dropdown"><ul>{{ #options }}<li data-value="{{ value }}" data-element="option"">{{ text }}</li>{{ /options }}</ul></div></div>'},d.prototype={initialize:function(){var b,d,e;for(var f in arguments){var g=arguments[f];g instanceof Function?e=g:g instanceof Object&&(d=g)}d||(d={}),b=c.createElement("div"),b.innerHTML=a.render(this.configs.template,d);for(var h in this.configs.attributes){var i=this.configs.attributes[h];"class"===i&&""!==this.element.className?b.childNodes[0].className=this.element.className:this.element.hasAttribute(i)&&b.childNodes[0].setAttribute("data-"+i,this.element[i])}return this.customElement=b.childNodes[0],this.element.parentNode.insertBefore(this.customElement,this.element.nextSibling),this.element.style.position="absolute",this.element.style.left="-9999px",e&&e.apply(this),this}},a.customize=function(f,g){function h(f,h){var i,j;if("FORM"===f.tagName&&a.customize(f,g),"INPUT"===f.tagName){if("radio"!==f.type&&"checkbox"!==f.type&&"submit"!==f.type&&"button"!==f.type)return!1;"radio"===f.type||"checkbox"===f.type?(h.hasOwnProperty("template")||(h.template=e.box),i=new d(f,h),i.initialize(function(){a.addClass(this.customElement,this.element.type),a.on(this.element,"change",function(){if(i.configs.callbacks.hasOwnProperty("beforechange")&&i.configs.callbacks.beforechange.apply(i.element),"radio"===f.type){var b=c.querySelectorAll('[data-name="'+f.name+'"]');if(b.length)for(var d=0;d<b.length;d++)a.removeClass(b[d],i.configs.classes.active)}i.element.checked?a.addClass(i.customElement,i.configs.classes.active):a.removeClass(i.customElement,i.configs.classes.active),i.configs.callbacks.hasOwnProperty("afterchange")&&i.configs.callbacks.afterchange.apply(i.element)}),a.on(this.element,"focus",function(){a.addClass(i.customElement,i.configs.classes.focus)}),a.on(this.element,"blur",function(){a.removeClass(i.customElement,i.configs.classes.focus)}),a.on(this.customElement,"click",function(){i.element.checked=a.hasClass(i.customElement,i.configs.classes.active)?!1:!0,a.fire(i.element,"change")})})):("submit"===f.type||"button"===f.type)&&(h.hasOwnProperty("template")||(h.template=e.button),i=new d(f,h),j=f.value,i.initialize({value:j},function(){a.on(this.customElement,"click",function(b){a.preventDefault(b),a.fire(i.element,"click")})}))}else if("SELECT"===f.tagName){h.hasOwnProperty("template")||(h.template=e.select),i=new d(f,h);var k,l;k=[];for(var m=0;m<f.length;m++){var n;n=f[m].textContent||f[m].text,j=f[m].value,f[m].selected&&(l=f[m].text||f[m].textContent),k.push({text:n,value:j})}i.initialize({selected:l,options:k},function(){function c(){a.removeClass(h,i.configs.classes.hide)}function d(){b.setTimeout(function(){a.addClass(h,i.configs.classes.hide)},200)}function e(a){for(var b=0;b<i.element.length;b++)if(i.element[b].value===a)return b}function f(b){var c;c=b.currentTarget.getAttribute("data-value"),i.element.selectedIndex=e(c),a.fire(i.element,"change")}var g,h,j;g=this.customElement.querySelector('[data-element="selected"]'),h=this.customElement.querySelector('[data-element="dropdown"]'),j=this.customElement.querySelectorAll('[data-element="option"]'),a.on(this.element,"change",function(){i.configs.callbacks.hasOwnProperty("beforechange")&&i.configs.callbacks.beforechange.apply(i.element);var b,c;b=i.element.selectedIndex,c=j[i.element.selectedIndex],a.removeClass(j,i.configs.classes.active),a.addClass(c,i.configs.classes.active),g.innerText=i.element[b].text||i.element[b].textContent,i.configs.callbacks.hasOwnProperty("afterchange")&&i.configs.callbacks.afterchange.apply(i.element)}),a.on(this.element,"focus",function(){a.addClass(i.customElement,i.configs.classes.focus),c()}),a.on(this.element,"blur",function(){a.removeClass(i.customElement,i.configs.classes.focus),d()}),g&&a.on(g,"click",function(){i.element.focus()});for(var k=0;k<j.length;k++)a.on(j[k],"click",f);d()})}}if(!f)throw new Error("No element was submitted...");if(f.length)for(var i=0;i<f.length;i++){var j,k,l;j={},g&&g.hasOwnProperty(f[i].name)&&(k=g[f[i].name],j=a.merge(j,k)),g&&g.hasOwnProperty(f[i].type)&&(l=g[f[i].type],j=a.merge(j,l)),h(f[i],j)}else h(f,g);return f}}(window.idex=window.idex||{},window,document);